[{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\api\\admin\\export\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\api\\rewards\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getReferralByInvited' is defined but never used.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getReferralByInvited"},"fix":{"range":[150,177],"text":""},"desc":"Remove unused variable \"getReferralByInvited\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DBSchema' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DBSchema"},"fix":{"range":[224,239],"text":""},"desc":"Remove unused variable \"DBSchema\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport {\r\n    readDB,\r\n    writeDB,\r\n    getOrCreateUser,\r\n    UserData,\r\n    createReferral,\r\n    getReferralByInvited,\r\n    checkAntiSybil,\r\n    recordAntiSybilData,\r\n    DBSchema\r\n} from '@/lib/db';\r\n\r\nexport async function GET(req: NextRequest) {\r\n    const { searchParams } = new URL(req.url);\r\n    const address = searchParams.get('address');\r\n\r\n    if (!address) {\r\n        return NextResponse.json({ error: 'Address required' }, { status: 400 });\r\n    }\r\n\r\n    const db = readDB();\r\n    const user = getOrCreateUser(address);\r\n\r\n    // Sort and get top 50\r\n    const leaderboard = Object.values(db.users)\r\n        .sort((a, b) => (b.points + b.referralPoints) - (a.points + a.referralPoints))\r\n        .slice(0, 50)\r\n        .map((u) => ({\r\n            address: u.address,\r\n            points: u.points + u.referralPoints,\r\n        }));\r\n\r\n    // Get referral details with quest progress for pending\r\n    const pendingReferrals = user.invites\r\n        .filter(addr => {\r\n            const referral = db.referrals[addr];\r\n            return !referral?.isValidated;\r\n        })\r\n        .map(addr => {\r\n            const referred = db.users[addr];\r\n            return {\r\n                address: addr,\r\n                questsCompleted: referred?.completedQuestsCount ?? 0,\r\n                questsRequired: 2,\r\n            };\r\n        });\r\n\r\n    const successfulReferrals = user.invites\r\n        .filter(addr => {\r\n            const referral = db.referrals[addr];\r\n            return referral?.isValidated;\r\n        })\r\n        .map(addr => {\r\n            const referral = db.referrals[addr];\r\n            return {\r\n                address: addr,\r\n                validatedAt: referral?.validatedAt ?? null,\r\n            };\r\n        });\r\n\r\n    return NextResponse.json({\r\n        user,\r\n        leaderboard,\r\n        referralStats: {\r\n            pending: pendingReferrals,\r\n            successful: successfulReferrals\r\n        }\r\n    });\r\n}\r\n\r\nimport { verifyTransaction } from '@/lib/verifyTransaction';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    const { address, amount, hash, referralCode, fingerprint } = await req.json();\r\n\r\n    if (!address || !amount || !hash) {\r\n        return NextResponse.json({ error: 'Missing data' }, { status: 400 });\r\n    }\r\n\r\n    // Server-side Verification\r\n    const verification = await verifyTransaction(hash, amount, address);\r\n    if (!verification.verified) {\r\n        return NextResponse.json({ error: 'Transaction verification failed' }, { status: 400 });\r\n    }\r\n\r\n    const db = readDB();\r\n    const user = getOrCreateUser(address);\r\n    const normalizedAddress = address.toLowerCase();\r\n\r\n    // Get IP from request headers\r\n    const ipAddress = req.headers.get('x-forwarded-for')?.split(',')[0] ||\r\n        req.headers.get('x-real-ip') ||\r\n        'unknown';\r\n\r\n    // Anti-Sybil check for referrals\r\n    if (referralCode && user.transactions === 0) {\r\n        const sybilCheck = checkAntiSybil(db, normalizedAddress, fingerprint, ipAddress);\r\n        if (!sybilCheck.allowed) {\r\n            return NextResponse.json({\r\n                error: 'Anti-Sybil protection triggered',\r\n                reason: sybilCheck.reason\r\n            }, { status: 403 });\r\n        }\r\n    }\r\n\r\n    // Record anti-Sybil data\r\n    recordAntiSybilData(db, normalizedAddress, fingerprint, ipAddress);\r\n\r\n    // Prevent duplicate processing\r\n    if (user.processedHashes.includes(hash)) {\r\n        return NextResponse.json({ user });\r\n    }\r\n\r\n    const value = parseFloat(amount);\r\n    user.transactions += 1;\r\n    user.volume += value;\r\n    user.dailyVolume += value;\r\n    user.weeklyVolume += value;\r\n    user.lastTxTimestamp = Date.now();\r\n    user.processedHashes.push(hash);\r\n\r\n    // Initial Referral Link logic with formal referrals table\r\n    if (referralCode && user.transactions === 1 && !user.referredBy) {\r\n        const inviter = Object.values(db.users).find((u) => u.referralCode === referralCode);\r\n        if (inviter && inviter.address !== normalizedAddress) {\r\n            // Check if inviter's fingerprint matches (anti-Sybil)\r\n            const inviterSybilData = db.antiSybil[inviter.address];\r\n            const userSybilData = db.antiSybil[normalizedAddress];\r\n\r\n            const isSameDevice = inviterSybilData?.fingerprint &&\r\n                userSybilData?.fingerprint &&\r\n                inviterSybilData.fingerprint === userSybilData.fingerprint;\r\n\r\n            if (!isSameDevice) {\r\n                user.referredBy = inviter.address;\r\n                if (!inviter.invites.includes(normalizedAddress)) {\r\n                    inviter.invites.push(normalizedAddress);\r\n                    db.users[inviter.address] = inviter;\r\n                }\r\n\r\n                // Create formal referral record\r\n                if (!db.referrals[normalizedAddress]) {\r\n                    db.referrals[normalizedAddress] = createReferral(inviter.address, normalizedAddress);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Points logic\r\n    let earnedPoints = 0;\r\n\r\n    // Daily Tasks\r\n    if (user.transactions >= 10 && !user.quests.dailyTx) {\r\n        user.quests.dailyTx = true;\r\n        earnedPoints += 100;\r\n        user.completedQuestsCount++;\r\n    }\r\n\r\n    const checkVolQuest = (vol: number, threshold: number, questKey: keyof UserData['quests'], points: number) => {\r\n        if (vol >= threshold && !user.quests[questKey]) {\r\n            (user.quests as Record<string, boolean>)[questKey] = true;\r\n            earnedPoints += points;\r\n            user.completedQuestsCount++;\r\n        }\r\n    };\r\n\r\n    checkVolQuest(user.dailyVolume, 1, 'dailyVol1', 1000);\r\n    checkVolQuest(user.dailyVolume, 5, 'dailyVol5', 5000);\r\n    checkVolQuest(user.dailyVolume, 10, 'dailyVol10', 10000);\r\n    checkVolQuest(user.dailyVolume, 50, 'dailyVol50', 50000);\r\n    checkVolQuest(user.dailyVolume, 100, 'dailyVol100', 100000);\r\n    checkVolQuest(user.weeklyVolume, 1, 'weeklyVol1', 10000);\r\n\r\n    user.points += earnedPoints;\r\n\r\n    // Activity-Based Referral Validation with formal referrals table\r\n    if (user.referredBy && user.completedQuestsCount >= 2) {\r\n        const referral = db.referrals[normalizedAddress];\r\n        if (referral && !referral.isValidated) {\r\n            const inviter = db.users[user.referredBy];\r\n            if (inviter) {\r\n                inviter.referralPoints += 500;\r\n                db.users[inviter.address] = inviter;\r\n\r\n                // Update referral record\r\n                referral.isValidated = true;\r\n                referral.validatedAt = Date.now();\r\n                db.referrals[normalizedAddress] = referral;\r\n            }\r\n        }\r\n    }\r\n\r\n    db.users[normalizedAddress] = user;\r\n    writeDB(db);\r\n\r\n    return NextResponse.json({ user, earnedPoints });\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\deposit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'nextDynamic' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"nextDynamic"},"fix":{"range":[112,151],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sidebar' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Sidebar"},"fix":{"range":[193,240],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Header' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Header"},"fix":{"range":[241,286],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Footer' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Footer"},"fix":{"range":[287,332],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":34,"column":9,"nodeType":"JSXOpeningElement","endLine":34,"endColumn":145}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from 'next';\nimport { Space_Grotesk } from 'next/font/google';\nimport './globals.css';\nimport nextDynamic from 'next/dynamic';\nimport { Providers } from './providers';\nimport { Sidebar } from '@/components/Sidebar';\nimport { Header } from '@/components/Header';\nimport { Footer } from '@/components/Footer';\nimport { AppLayout } from '@/components/AppLayout';\n\nimport { FloatingBackgroundWrapper } from '@/components/FloatingBackgroundWrapper';\n\nconst spaceGrotesk = Space_Grotesk({\n  subsets: ['latin'],\n  variable: '--font-space-grotesk',\n  weight: ['300', '400', '500', '600', '700'],\n});\n\nexport const metadata: Metadata = {\n  title: 'Who Knows? - Privacy Mixer',\n  description: 'Web3 Privacy App',\n};\n\nexport const dynamic = 'force-dynamic';\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\" className=\"dark\">\n      <head>\n        <link href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\" rel=\"stylesheet\" />\n      </head>\n      <body className={`${spaceGrotesk.variable} antialiased bg-background-light dark:bg-background-dark font-display text-white selection:bg-primary/30 min-h-screen relative overflow-hidden`}>\n        <Providers>\n          {/* Background Assets */}\n          <FloatingBackgroundWrapper />\n\n          <div className=\"relative h-screen w-full overflow-hidden\">\n            <AppLayout>\n              {children}\n            </AppLayout>\n          </div>\n        </Providers>\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\providers.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a variable defined outside a component or hook is not allowed. Consider using an effect.\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\providers.tsx:24:10\n  22 |     // Suppress Lit Dev Mode Warning\n  23 |     if (typeof window !== 'undefined') {\n> 24 |         (window as any).litIssuedWarnings = new Set(['Lit is in dev mode. Not recommended for production!']);\n     |          ^^^^^^^^^^^^^ value cannot be modified\n  25 |     }\n  26 |\n  27 |     useEffect(() => {","line":24,"column":10,"nodeType":null,"endLine":24,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport * as React from 'react';\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n    RainbowKitProvider,\r\n    darkTheme,\r\n} from '@rainbow-me/rainbowkit';\r\nimport { WagmiProvider } from 'wagmi';\r\nimport {\r\n    QueryClientProvider,\r\n    QueryClient,\r\n} from \"@tanstack/react-query\";\r\nimport { config } from '../lib/config';\r\nimport '@rainbow-me/rainbowkit/styles.css';\r\n\r\nconst queryClient = new QueryClient();\r\n\r\nexport function Providers({ children }: { children: React.ReactNode }) {\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    // Suppress Lit Dev Mode Warning\r\n    if (typeof window !== 'undefined') {\r\n        (window as any).litIssuedWarnings = new Set(['Lit is in dev mode. Not recommended for production!']);\r\n    }\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    // Prevent hydration mismatch - wait for client mount\r\n    if (!mounted) return null;\r\n\r\n    return (\r\n        <QueryClientProvider client={queryClient}>\r\n            <WagmiProvider config={config}>\r\n                <RainbowKitProvider theme={darkTheme({\r\n                    accentColor: '#2b8cee',\r\n                    accentColorForeground: 'white',\r\n                    borderRadius: 'medium',\r\n                    fontStack: 'system',\r\n                })}>\r\n                    {children}\r\n                </RainbowKitProvider>\r\n            </WagmiProvider>\r\n        </QueryClientProvider>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\rewards\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRewards'. Either include it or remove the dependency array.","line":69,"column":8,"nodeType":"ArrayExpression","endLine":69,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [isConnected, address, fetchRewards]","fix":{"range":[1842,1864],"text":"[isConnected, address, fetchRewards]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":189,"column":119,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every &quot;Valid\" referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every &ldquo;Valid\" referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every &#34;Valid\" referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every &rdquo;Valid\" referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":189,"column":125,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every \"Valid&quot; referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every \"Valid&ldquo; referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every \"Valid&#34; referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10100,10218],"text":"Invite friends and earn 500 points for every \"Valid&rdquo; referral. A referral is valid after the user completes 2+ quests."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useAccount } from 'wagmi';\r\nimport { ConnectButton } from '@rainbow-me/rainbowkit';\r\n\r\ntype UserRewardsData = {\r\n    address: string;\r\n    points: number;\r\n    referralPoints: number;\r\n    referralCode: string;\r\n    invites: string[];\r\n    transactions: number;\r\n    volume: number;\r\n    completedQuestsCount: number;\r\n    quests: {\r\n        dailyTx: boolean;\r\n        dailyVol1: boolean;\r\n        dailyVol5: boolean;\r\n        dailyVol10: boolean;\r\n        dailyVol50: boolean;\r\n        dailyVol100: boolean;\r\n        weeklyVol1: boolean;\r\n    };\r\n};\r\n\r\ntype LeaderboardItem = {\r\n    address: string;\r\n    points: number;\r\n};\r\n\r\ntype ReferralStats = {\r\n    pending: Array<{\r\n        address: string;\r\n        questsCompleted: number;\r\n        questsRequired: number;\r\n    }>;\r\n    successful: Array<{\r\n        address: string;\r\n        validatedAt: number | null;\r\n    }>;\r\n};\r\n\r\nexport default function RewardsPage() {\r\n    const { address, isConnected } = useAccount();\r\n    const [data, setData] = useState<{ user: UserRewardsData; leaderboard: LeaderboardItem[]; referralStats: ReferralStats } | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [copyStatus, setCopyStatus] = useState<'idle' | 'copied'>('idle');\r\n\r\n    const fetchRewards = async () => {\r\n        if (!address) return;\r\n        try {\r\n            const res = await fetch(`/api/rewards?address=${address}`);\r\n            const json = await res.json();\r\n            setData(json);\r\n        } catch (e) {\r\n            console.error(e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (isConnected && address) {\r\n            fetchRewards();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, [isConnected, address]);\r\n\r\n    const handleCopyReferral = () => {\r\n        if (!data?.user.referralCode) return;\r\n        const link = `${window.location.origin}/deposit?ref=${data.user.referralCode}`;\r\n        navigator.clipboard.writeText(link);\r\n        setCopyStatus('copied');\r\n        setTimeout(() => setCopyStatus('idle'), 2000);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex-1 flex items-center justify-center\">\r\n                <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!isConnected) {\r\n        return (\r\n            <div className=\"flex-1 flex flex-col items-center justify-center p-6\">\r\n                <div className=\"glass-card p-12 rounded-2xl text-center max-w-lg w-full\">\r\n                    <span className=\"material-symbols-outlined text-6xl text-white/20 mb-4\">emoji_events</span>\r\n                    <h2 className=\"text-3xl font-bold mb-4\">Join the Rewards Program</h2>\r\n                    <p className=\"text-white/40 mb-8\">Connect your wallet to track your transaction volume, earn points, and climb the leaderboard.</p>\r\n                    <div className=\"flex justify-center\">\r\n                        <ConnectButton />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const QUESTS = [\r\n        { id: 'dailyTx', title: 'Daily Mix Master', desc: 'Complete 10 transactions in a day', points: 100, completed: data?.user.quests.dailyTx },\r\n        { id: 'dailyVol1', title: 'Volume Starter', desc: 'Mix 1 ETH volume in a day', points: 1000, completed: data?.user.quests.dailyVol1 },\r\n        { id: 'dailyVol5', title: 'Volume Enthusiast', desc: 'Mix 5 ETH volume in a day', points: 5000, completed: data?.user.quests.dailyVol5 },\r\n        { id: 'dailyVol10', title: 'Volume Pro', desc: 'Mix 10 ETH volume in a day', points: 10000, completed: data?.user.quests.dailyVol10 },\r\n        { id: 'dailyVol50', title: 'High Roller', desc: 'Mix 50 ETH volume in a day', points: 50000, completed: data?.user.quests.dailyVol50 },\r\n        { id: 'dailyVol100', title: 'Privacy Whale', desc: 'Mix 100 ETH volume in a day', points: 100000, completed: data?.user.quests.dailyVol100 },\r\n        { id: 'weeklyVol1', title: 'Weekly Grind', desc: 'Mix 1 ETH minimum volume in a week', points: 10000, completed: data?.user.quests.weeklyVol1 },\r\n    ];\r\n\r\n    const totalPoints = (data?.user.points ?? 0) + (data?.user.referralPoints ?? 0);\r\n    const userRank = data?.leaderboard.findIndex(item => item.address === address?.toLowerCase()) ?? -1;\r\n    const rankText = userRank !== -1 ? `#${userRank + 1}` : 'Unranked';\r\n\r\n    return (\r\n        <div className=\"flex-1 p-12 max-w-7xl mx-auto w-full pt-24 pb-20 overflow-y-auto\">\r\n            <div className=\"mb-12\">\r\n                <h1 className=\"text-4xl font-bold mb-2\">Rewards Program</h1>\r\n                <p className=\"text-white/40 uppercase tracking-widest text-xs font-bold\">Gamified Privacy Mixing</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left Column: Stats & Referrals */}\r\n                <div className=\"lg:col-span-2 space-y-8\">\r\n                    {/* User Stats */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                        <div className=\"glass-card p-6 rounded-2xl metallic-border flex flex-col\">\r\n                            <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold mb-1\">Total Points</span>\r\n                            <span className=\"text-3xl font-bold text-primary\">{totalPoints.toLocaleString()}</span>\r\n                            <div className=\"flex gap-2 mt-2\">\r\n                                <span className=\"text-[10px] text-white/40\">Quests: {data?.user.points.toLocaleString()}</span>\r\n                                <span className=\"text-[10px] text-green-400/60\">Ref: {data?.user.referralPoints.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"glass-card p-6 rounded-2xl metallic-border flex flex-col\">\r\n                            <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold mb-1\">Global Rank</span>\r\n                            <span className=\"text-3xl font-bold text-white\">{rankText}</span>\r\n                            <span className=\"text-[10px] text-white/20 mt-2 uppercase tracking-tighter\">Top 50 Leaderboard</span>\r\n                        </div>\r\n                        <div className=\"glass-card p-6 rounded-2xl metallic-border flex flex-col\">\r\n                            <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold mb-1\">Valid Referrals</span>\r\n                            <span className=\"text-3xl font-bold text-green-400\">{data?.referralStats.successful.length ?? 0}</span>\r\n                            <span className=\"text-[10px] text-white/20 mt-2 uppercase tracking-tighter\">Unlimited invites</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Quest Dashboard */}\r\n                    <div className=\"glass-card rounded-2xl metallic-border overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-white/5 bg-white/5\">\r\n                            <h3 className=\"text-lg font-bold flex items-center gap-2\">\r\n                                <span className=\"material-symbols-outlined text-primary\">assignment</span>\r\n                                Quest Dashboard\r\n                            </h3>\r\n                        </div>\r\n                        <div className=\"divide-y divide-white/5\">\r\n                            {QUESTS.map((quest) => (\r\n                                <div key={quest.id} className=\"p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"font-bold text-white/90\">{quest.title}</span>\r\n                                            <span className=\"text-[10px] bg-primary/20 text-primary px-2 py-0.5 rounded-full font-bold\">+{quest.points} PTS</span>\r\n                                        </div>\r\n                                        <p className=\"text-sm text-white/40\">{quest.desc}</p>\r\n                                    </div>\r\n                                    <div>\r\n                                        {quest.completed ? (\r\n                                            <span className=\"flex items-center gap-1 text-green-400 text-sm font-bold bg-green-400/10 px-3 py-1 rounded-full\">\r\n                                                <span className=\"material-symbols-outlined text-sm\">check_circle</span>\r\n                                                Claimed\r\n                                            </span>\r\n                                        ) : (\r\n                                            <span className=\"text-white/20 text-sm font-medium border border-white/10 px-3 py-1 rounded-full italic\">\r\n                                                In Progress\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Referral Section (Updated with Unlimited & Validation Logic) */}\r\n                    <div className=\"glass-card rounded-2xl metallic-border overflow-hidden bg-gradient-to-br from-primary/[0.03] to-transparent\">\r\n                        <div className=\"p-8 pb-4\">\r\n                            <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                                <div className=\"max-w-md\">\r\n                                    <h3 className=\"text-xl font-bold mb-2\">Unlimited Referrals</h3>\r\n                                    <p className=\"text-white/40 text-sm\">Invite friends and earn 500 points for every \"Valid\" referral. A referral is valid after the user completes 2+ quests.</p>\r\n                                </div>\r\n                                <div className=\"flex flex-col gap-2 w-full md:w-auto\">\r\n                                    <button\r\n                                        onClick={handleCopyReferral}\r\n                                        className={`px-8 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${copyStatus === 'copied' ? 'bg-green-500 text-white' : 'bg-primary text-white silver-glow'}`}\r\n                                    >\r\n                                        <span className=\"material-symbols-outlined text-lg\">\r\n                                            {copyStatus === 'copied' ? 'check' : 'link'}\r\n                                        </span>\r\n                                        {copyStatus === 'copied' ? 'Link Copied!' : 'Copy Referral Link'}\r\n                                    </button>\r\n                                    <p className=\"text-center text-[10px] text-white/20 uppercase tracking-widest\">Your Code: {data?.user.referralCode}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-white/5 border-t border-white/5 bg-black/20\">\r\n                            <div className=\"p-6\">\r\n                                <h4 className=\"text-[10px] uppercase tracking-widest font-bold text-white/30 mb-4 flex items-center gap-2\">\r\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-yellow-400 animate-pulse\"></span>\r\n                                    Pending Validation ({data?.referralStats.pending.length ?? 0})\r\n                                </h4>\r\n                                <div className=\"space-y-2 max-h-[150px] overflow-y-auto pr-2 custom-scrollbar\">\r\n                                    {data?.referralStats.pending.map((ref) => (\r\n                                        <div key={ref.address} className=\"flex items-center justify-between text-xs p-2 rounded bg-white/[0.02]\">\r\n                                            <span className=\"font-mono text-white/40\">{ref.address.substring(0, 10)}...{ref.address.substring(34)}</span>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"flex gap-0.5\">\r\n                                                    {[0, 1].map((i) => (\r\n                                                        <div\r\n                                                            key={i}\r\n                                                            className={`w-2 h-2 rounded-full ${i < ref.questsCompleted ? 'bg-yellow-400' : 'bg-white/10'}`}\r\n                                                        />\r\n                                                    ))}\r\n                                                </div>\r\n                                                <span className=\"text-[9px] text-yellow-400/50 uppercase font-bold tracking-tighter\">\r\n                                                    {ref.questsCompleted}/{ref.questsRequired} Quests\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                    {data?.referralStats.pending.length === 0 && (\r\n                                        <p className=\"text-[10px] italic text-white/10 text-center py-4\">No pending referrals</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"p-6\">\r\n                                <h4 className=\"text-[10px] uppercase tracking-widest font-bold text-white/30 mb-4 flex items-center gap-2\">\r\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-green-400\"></span>\r\n                                    Verified & Rewarded ({data?.referralStats.successful.length ?? 0})\r\n                                </h4>\r\n                                <div className=\"space-y-2 max-h-[150px] overflow-y-auto pr-2 custom-scrollbar\">\r\n                                    {data?.referralStats.successful.map((ref) => (\r\n                                        <div key={ref.address} className=\"flex items-center justify-between text-xs p-2 rounded bg-green-400/5 border border-green-500/10\">\r\n                                            <span className=\"font-mono text-white/60\">{ref.address.substring(0, 10)}...{ref.address.substring(34)}</span>\r\n                                            <span className=\"text-[9px] text-green-400 font-bold uppercase tracking-tighter\">+500 PTS</span>\r\n                                        </div>\r\n                                    ))}\r\n                                    {data?.referralStats.successful.length === 0 && (\r\n                                        <p className=\"text-[10px] italic text-white/10 text-center py-4\">No successful referrals yet</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Leaderboard */}\r\n                <div className=\"glass-card rounded-2xl metallic-border flex flex-col h-[fit-content] max-h-[850px]\">\r\n                    <div className=\"p-6 border-b border-white/5 bg-white/5 sticky top-0 z-10\">\r\n                        <h3 className=\"text-lg font-bold flex items-center gap-2\">\r\n                            <span className=\"material-symbols-outlined text-primary\">leaderboard</span>\r\n                            Leaderboard\r\n                        </h3>\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-y-auto divide-y divide-white/5\">\r\n                        {data?.leaderboard.map((item, index) => (\r\n                            <div key={item.address} className={`p-5 flex items-center justify-between ${item.address === address?.toLowerCase() ? 'bg-primary/5' : ''}`}>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <span className={`w-6 text-sm font-bold ${index < 3 ? 'text-primary' : 'text-white/20'}`}>\r\n                                        {index + 1}\r\n                                    </span>\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-sm font-mono text-white/80\">\r\n                                            {item.address.substring(0, 6)}...{item.address.substring(38)}\r\n                                        </span>\r\n                                        {item.address === address?.toLowerCase() && (\r\n                                            <span className=\"text-[10px] text-primary font-bold uppercase tracking-widest\">You</span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <span className=\"text-sm font-bold text-white/60\">\r\n                                    {item.points.toLocaleString()} <span className=\"text-[10px] text-white/20\">PTS</span>\r\n                                </span>\r\n                            </div>\r\n                        ))}\r\n                        {data?.leaderboard.length === 0 && (\r\n                            <div className=\"p-12 text-center\">\r\n                                <p className=\"text-white/20 text-sm italic\">No participants yet</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\app\\withdraw\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\FloatingBackground.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\FloatingBackgroundWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\Footer.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\Footer.tsx:13:9\n  11 |\n  12 |     useEffect(() => {\n> 13 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  14 |     }, []);\n  15 |\n  16 |     if (!mounted) {","line":13,"column":9,"nodeType":null,"endLine":13,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useContractMetrics } from '@/hooks/useSmartContract';\r\nimport { useChainId } from 'wagmi';\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport function Footer() {\r\n    const { tvl, anonymitySet, dailyVolume } = useContractMetrics();\r\n    const chainId = useChainId();\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    if (!mounted) {\r\n        return (\r\n            <footer className=\"w-full border-t border-white/5 py-6 px-12 bg-background-dark/50 backdrop-blur-md mt-auto min-h-[80px]\">\r\n                <div className=\"max-w-6xl mx-auto flex justify-between items-center opacity-0 uppercase text-[10px] tracking-widest font-bold text-white/30\">\r\n                    Syncing Metrics...\r\n                </div>\r\n            </footer>\r\n        );\r\n    }\r\n\r\n    const networkName = chainId === 11155111 ? 'Ethereum Sepolia' :\r\n        chainId === 84532 ? 'Base Sepolia' :\r\n            'Unknown Network';\r\n\r\n    return (\r\n        <footer className=\"w-full border-t border-white/5 py-6 px-12 bg-background-dark/50 backdrop-blur-md mt-auto min-h-[80px]\">\r\n            <div className=\"max-w-6xl mx-auto flex justify-between items-center\">\r\n                <div className=\"flex gap-12\">\r\n                    <div className=\"flex flex-col\">\r\n                        <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold\">Total Value Locked</span>\r\n                        <span className=\"text-white/80 text-sm font-medium\">{tvl} ETH</span>\r\n                    </div>\r\n                    <div className=\"flex flex-col border-l border-white/5 pl-12\">\r\n                        <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold\">Anonymity Set</span>\r\n                        <span className=\"text-white/80 text-sm font-medium\">{anonymitySet} Participants</span>\r\n                    </div>\r\n                    <div className=\"flex flex-col border-l border-white/5 pl-12\">\r\n                        <span className=\"text-white/30 text-[10px] uppercase tracking-widest font-bold\">24h Mix Volume</span>\r\n                        <span className=\"text-white/80 text-sm font-medium\">{dailyVolume} ETH</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-6\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"material-symbols-outlined text-[16px] text-primary\">public</span>\r\n                        <span className=\"text-white/40 text-xs\">{networkName}</span>\r\n                    </div>\r\n                    <span className=\"text-white/20 text-[10px] uppercase tracking-tighter\">Powered by ZK-SNARKs</span>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\Header.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":88,"column":53,"nodeType":"JSXOpeningElement","endLine":92,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { ConnectButton } from '@rainbow-me/rainbowkit';\r\n\r\nexport function Header({ onOpenMenu }: { onOpenMenu: () => void }) {\r\n    return (\r\n        <header className=\"w-full flex justify-between md:justify-end items-center p-6 md:p-8 absolute top-0 left-0 z-20 pointer-events-none\">\r\n            {/* Mobile Hamburger */}\r\n            <button\r\n                onClick={onOpenMenu}\r\n                className=\"md:hidden pointer-events-auto p-2 bg-white/5 rounded-lg border border-white/10 text-white\"\r\n            >\r\n                <span className=\"material-symbols-outlined\">menu</span>\r\n            </button>\r\n\r\n            <div className=\"pointer-events-auto flex items-center gap-3\">\r\n                <EthereumConnectButton />\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n\r\n/**\r\n * Ethereum Connect Button using RainbowKit\r\n */\r\nfunction EthereumConnectButton() {\r\n    return (\r\n        <ConnectButton.Custom>\r\n            {({\r\n                account,\r\n                chain,\r\n                openAccountModal,\r\n                openChainModal,\r\n                openConnectModal,\r\n                mounted,\r\n            }) => {\r\n                const ready = mounted;\r\n                const connected = ready && account && chain;\r\n\r\n                return (\r\n                    <div\r\n                        {...(!ready && {\r\n                            'aria-hidden': true,\r\n                            'style': {\r\n                                opacity: 0,\r\n                                pointerEvents: 'none',\r\n                                userSelect: 'none',\r\n                            },\r\n                        })}\r\n                    >\r\n                        {(() => {\r\n                            if (!connected) {\r\n                                return (\r\n                                    <button onClick={openConnectModal} className=\"flex items-center gap-2 px-6 py-2.5 rounded-full border border-silver/30 bg-white/5 hover:bg-white/10 text-white transition-all duration-300 silver-glow backdrop-blur-sm group cursor-pointer\">\r\n                                        <span className=\"material-symbols-outlined text-lg text-silver group-hover:text-white transition-colors\">account_balance_wallet</span>\r\n                                        <span className=\"text-sm font-medium tracking-wider uppercase hidden sm:inline\">Connect ETH</span>\r\n                                        <span className=\"text-sm font-medium tracking-wider uppercase sm:hidden\">‚ü†</span>\r\n                                    </button>\r\n                                );\r\n                            }\r\n\r\n                            if (chain.unsupported) {\r\n                                return (\r\n                                    <button onClick={openChainModal} className=\"px-6 py-2.5 rounded-full border border-red-500/30 bg-red-500/10 text-red-500 font-medium\">\r\n                                        Wrong network\r\n                                    </button>\r\n                                );\r\n                            }\r\n\r\n                            return (\r\n                                <div style={{ display: 'flex', gap: 12 }}>\r\n                                    <button\r\n                                        onClick={openChainModal}\r\n                                        className=\"hidden sm:flex items-center gap-2 px-4 py-2 rounded-full border border-white/10 bg-white/5 text-white\"\r\n                                        type=\"button\"\r\n                                    >\r\n                                        {chain.hasIcon && (\r\n                                            <div\r\n                                                style={{\r\n                                                    background: chain.iconBackground,\r\n                                                    width: 12,\r\n                                                    height: 12,\r\n                                                    borderRadius: 999,\r\n                                                    overflow: 'hidden',\r\n                                                    marginRight: 4,\r\n                                                }}\r\n                                            >\r\n                                                {chain.iconUrl && (\r\n                                                    <img\r\n                                                        alt={chain.name ?? 'Chain icon'}\r\n                                                        src={chain.iconUrl}\r\n                                                        style={{ width: 12, height: 12 }}\r\n                                                    />\r\n                                                )}\r\n                                            </div>\r\n                                        )}\r\n                                        {chain.name}\r\n                                    </button>\r\n\r\n                                    <button onClick={openAccountModal} type=\"button\" className=\"px-4 sm:px-6 py-2.5 rounded-full border border-silver/30 bg-white/5 hover:bg-white/10 text-white transition-all silver-glow backdrop-blur-sm text-sm\">\r\n                                        {account.displayName}\r\n                                        <span className=\"hidden sm:inline\">\r\n                                            {account.displayBalance\r\n                                                ? ` (${account.displayBalance})`\r\n                                                : ''}\r\n                                        </span>\r\n                                    </button>\r\n                                </div>\r\n                            );\r\n                        })()}\r\n                    </div>\r\n                );\r\n            }}\r\n        </ConnectButton.Custom>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\HistoryModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\HistoryModal.tsx:27:13\n  25 |         if (isOpen) {\n  26 |             const stored = JSON.parse(localStorage.getItem('who-knows-history') || '[]');\n> 27 |             setHistory(stored);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  28 |         }\n  29 |     }, [isOpen]);\n  30 |","line":27,"column":13,"nodeType":null,"endLine":27,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Modal } from '@/components/Modal';\r\n\r\ninterface HistoryItem {\r\n    type: 'Deposit' | 'Withdraw';\r\n    hash: string;\r\n    timestamp: number;\r\n    status: string;\r\n}\r\n\r\ninterface HistoryModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nimport { useAccount } from 'wagmi';\r\n\r\nexport function HistoryModal({ isOpen, onClose }: HistoryModalProps) {\r\n    const [history, setHistory] = useState<HistoryItem[]>([]);\r\n    const { chain } = useAccount();\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            const stored = JSON.parse(localStorage.getItem('who-knows-history') || '[]');\r\n            setHistory(stored);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const clearHistory = () => {\r\n        localStorage.removeItem('who-knows-history');\r\n        setHistory([]);\r\n    };\r\n\r\n    const getExplorerUrl = (hash: string) => {\r\n        const baseUrl = chain?.blockExplorers?.default.url || 'https://megaeth-testnet-v2.blockscout.com';\r\n        return `${baseUrl}/tx/${hash}`;\r\n    };\r\n\r\n    return (\r\n        <Modal isOpen={isOpen} onClose={onClose} title=\"Transaction History\">\r\n            <div className=\"flex flex-col gap-4 max-h-[60vh] overflow-y-auto pr-2\">\r\n                {history.length === 0 ? (\r\n                    <p className=\"text-white/40 text-center py-8\">No transactions found.</p>\r\n                ) : (\r\n                    history.map((item, idx) => (\r\n                        <div key={idx} className=\"bg-white/5 border border-white/10 rounded-lg p-3 flex flex-col gap-1\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className={`text-xs font-bold uppercase tracking-wider ${item.type === 'Deposit' ? 'text-green-400' : 'text-red-400'}`}>\r\n                                    {item.type}\r\n                                </span>\r\n                                <span className=\"text-[10px] text-white/30\">\r\n                                    {new Date(item.timestamp).toLocaleString()}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between gap-2\">\r\n                                <p className=\"text-[10px] font-mono text-white/60 truncate max-w-[200px]\">\r\n                                    {item.hash}\r\n                                </p>\r\n                                <a\r\n                                    href={getExplorerUrl(item.hash)}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"text-[10px] text-primary hover:text-primary/80 flex items-center gap-1 hover:underline\"\r\n                                >\r\n                                    Explorer <span className=\"material-symbols-outlined text-[10px]\">open_in_new</span>\r\n                                </a>\r\n                            </div>\r\n                            <span className=\"text-[10px] text-primary self-end\">Confirmed</span>\r\n                        </div>\r\n                    ))\r\n                )}\r\n\r\n                {history.length > 0 && (\r\n                    <button\r\n                        onClick={clearHistory}\r\n                        className=\"mt-2 text-xs text-white/30 hover:text-white/50 underline self-center\"\r\n                    >\r\n                        Clear History\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </Modal>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\hooks\\useSmartContract.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\hooks\\useSmartContract.ts:162:13\n  160 |     useEffect(() => {\n  161 |         if (isConfirmed && hash && hash !== lastProcessedHash && address && pendingAmount) {\n> 162 |             setIsSuccess(true);\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  163 |             setLastProcessedHash(hash);\n  164 |\n  165 |             const historyItem = {","line":162,"column":13,"nodeType":null,"endLine":162,"endColumn":25},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\hooks\\useSmartContract.ts:246:13\n  244 |     useEffect(() => {\n  245 |         if (isConfirmed) {\n> 246 |             setIsSuccess(true);\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  247 |             const historyItem = {\n  248 |                 type: 'Withdraw',\n  249 |                 hash: hash,","line":246,"column":13,"nodeType":null,"endLine":246,"endColumn":25},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\hooks\\useSmartContract.ts:260:13\n  258 |     useEffect(() => {\n  259 |         if (writeError) {\n> 260 |             setError(writeError.message);\n      |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  261 |         }\n  262 |     }, [writeError]);\n  263 |","line":260,"column":13,"nodeType":null,"endLine":260,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAccount, useWriteContract, useWaitForTransactionReceipt, useReadContract, useChainId, useWatchContractEvent } from 'wagmi';\r\nimport { parseEther, formatEther } from 'viem';\r\nimport { CONTRACT_ADDRESSES, DEFAULT_CONTRACT_ADDRESS } from '../lib/addresses';\r\n\r\n// Presets for the UI\r\nexport const PRESETS = [\r\n    { amount: '0.1', label: '0.1 ETH' },\r\n    { amount: '1', label: '1 ETH' },\r\n    { amount: '10', label: '10 ETH' },\r\n] as const;\r\n\r\nexport const FEE_PERCENT = 0.005; // 0.5%\r\nexport const MIN_DEPOSIT = '0.01';\r\n\r\n// Contract ABI\r\nconst ABI = [\r\n    {\r\n        inputs: [{ name: 'commitment', type: 'bytes32' }],\r\n        name: 'deposit',\r\n        outputs: [],\r\n        stateMutability: 'payable',\r\n        type: 'function',\r\n    },\r\n    {\r\n        inputs: [\r\n            { name: 'secret', type: 'string' },\r\n            { name: 'recipient', type: 'address' },\r\n        ],\r\n        name: 'withdraw',\r\n        outputs: [],\r\n        stateMutability: 'nonpayable',\r\n        type: 'function',\r\n    },\r\n    {\r\n        inputs: [{ name: 'commitment', type: 'bytes32' }],\r\n        name: 'getDepositStatus',\r\n        outputs: [\r\n            { name: 'exists', type: 'bool' },\r\n            { name: 'isWithdrawn', type: 'bool' }\r\n        ],\r\n        stateMutability: 'view',\r\n        type: 'function',\r\n    },\r\n    {\r\n        inputs: [],\r\n        name: 'totalValueLocked',\r\n        outputs: [{ name: '', type: 'uint256' }],\r\n        stateMutability: 'view',\r\n        type: 'function',\r\n    },\r\n    {\r\n        inputs: [],\r\n        name: 'anonymitySet',\r\n        outputs: [{ name: '', type: 'uint256' }],\r\n        stateMutability: 'view',\r\n        type: 'function',\r\n    },\r\n    {\r\n        inputs: [],\r\n        name: 'dailyVolume',\r\n        outputs: [{ name: '', type: 'uint256' }],\r\n        stateMutability: 'view',\r\n        type: 'function',\r\n    },\r\n    {\r\n        anonymous: false,\r\n        inputs: [\r\n            { indexed: true, name: 'commitment', type: 'bytes32' },\r\n            { indexed: false, name: 'amount', type: 'uint256' },\r\n            { indexed: false, name: 'timestamp', type: 'uint256' }\r\n        ],\r\n        name: 'Deposit',\r\n        type: 'event',\r\n    },\r\n    {\r\n        anonymous: false,\r\n        inputs: [\r\n            { indexed: true, name: 'recipient', type: 'address' },\r\n            { indexed: false, name: 'amount', type: 'uint256' },\r\n            { indexed: false, name: 'fee', type: 'uint256' },\r\n            { indexed: false, name: 'timestamp', type: 'uint256' }\r\n        ],\r\n        name: 'Withdrawal',\r\n        type: 'event',\r\n    },\r\n] as const;\r\n\r\nexport const useSmartContractAddress = () => {\r\n    const chainId = useChainId();\r\n    return CONTRACT_ADDRESSES[chainId] || DEFAULT_CONTRACT_ADDRESS;\r\n};\r\n\r\nexport const useContractMetrics = () => {\r\n    const address = useSmartContractAddress();\r\n\r\n    // Total Value Locked\r\n    const { data: tvl, refetch: refetchTVL } = useReadContract({\r\n        address,\r\n        abi: ABI,\r\n        functionName: 'totalValueLocked',\r\n    });\r\n\r\n    // Anonymity Set\r\n    const { data: anonSet, refetch: refetchAnon } = useReadContract({\r\n        address,\r\n        abi: ABI,\r\n        functionName: 'anonymitySet',\r\n    });\r\n\r\n    // Daily Volume\r\n    const { data: volume, refetch: refetchVolume } = useReadContract({\r\n        address,\r\n        abi: ABI,\r\n        functionName: 'dailyVolume',\r\n    });\r\n\r\n    const refresh = () => {\r\n        refetchTVL();\r\n        refetchAnon();\r\n        refetchVolume();\r\n    };\r\n\r\n    // Watch for events to refresh data in real-time\r\n    useWatchContractEvent({\r\n        address,\r\n        abi: ABI,\r\n        eventName: 'Deposit',\r\n        onLogs() { refresh(); },\r\n    });\r\n\r\n    useWatchContractEvent({\r\n        address,\r\n        abi: ABI,\r\n        eventName: 'Withdrawal',\r\n        onLogs() { refresh(); },\r\n    });\r\n\r\n    return {\r\n        tvl: tvl ? parseFloat(formatEther(tvl)).toFixed(2) : '0.00',\r\n        anonymitySet: anonSet ? anonSet.toString() : '0',\r\n        dailyVolume: volume ? parseFloat(formatEther(volume)).toFixed(2) : '0.00',\r\n        refresh\r\n    };\r\n};\r\n\r\nexport const useDeposit = () => {\r\n    const { address, isConnected } = useAccount();\r\n    const contractAddress = useSmartContractAddress();\r\n    const { writeContract, data: hash, isPending: isWritePending, error: writeError } = useWriteContract();\r\n    const { isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForTransactionReceipt({ hash });\r\n\r\n    const [isSuccess, setIsSuccess] = useState(false);\r\n    const [lastProcessedHash, setLastProcessedHash] = useState<string | null>(null);\r\n    const [pendingAmount, setPendingAmount] = useState<string | null>(null);\r\n    const [activeReferralCode, setActiveReferralCode] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (isConfirmed && hash && hash !== lastProcessedHash && address && pendingAmount) {\r\n            setIsSuccess(true);\r\n            setLastProcessedHash(hash);\r\n\r\n            const historyItem = {\r\n                type: 'Deposit',\r\n                hash: hash,\r\n                timestamp: Date.now(),\r\n                status: 'Success'\r\n            };\r\n            const existing = JSON.parse(localStorage.getItem('who-knows-history') || '[]');\r\n            localStorage.setItem('who-knows-history', JSON.stringify([historyItem, ...existing]));\r\n\r\n            // Generate simple browser fingerprint for anti-Sybil\r\n            const generateFingerprint = (): string => {\r\n                const components = [\r\n                    navigator.userAgent,\r\n                    navigator.language,\r\n                    screen.width + 'x' + screen.height,\r\n                    screen.colorDepth,\r\n                    new Date().getTimezoneOffset(),\r\n                    navigator.hardwareConcurrency || 0,\r\n                    (navigator as unknown as { deviceMemory?: number }).deviceMemory || 0,\r\n                ];\r\n                const str = components.join('|');\r\n                // Simple hash function\r\n                let hash = 0;\r\n                for (let i = 0; i < str.length; i++) {\r\n                    const char = str.charCodeAt(i);\r\n                    hash = ((hash << 5) - hash) + char;\r\n                    hash = hash & hash;\r\n                }\r\n                return Math.abs(hash).toString(36);\r\n            };\r\n\r\n            // Update Rewards Points with fingerprint\r\n            fetch('/api/rewards', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    address: address,\r\n                    amount: pendingAmount,\r\n                    hash: hash,\r\n                    referralCode: activeReferralCode,\r\n                    fingerprint: generateFingerprint()\r\n                })\r\n            }).catch(console.error);\r\n        }\r\n    }, [isConfirmed, hash, address, pendingAmount, lastProcessedHash, activeReferralCode]);\r\n\r\n    const deposit = async (amount: string, commitment: string, referralCode?: string) => {\r\n        if (!isConnected) throw new Error('Wallet not connected');\r\n        setPendingAmount(amount);\r\n        if (referralCode) setActiveReferralCode(referralCode);\r\n\r\n        writeContract({\r\n            address: contractAddress,\r\n            abi: ABI,\r\n            functionName: 'deposit',\r\n            args: [commitment as `0x${string}`],\r\n            value: parseEther(amount),\r\n        });\r\n    };\r\n\r\n    return {\r\n        deposit,\r\n        isPending: isWritePending || isConfirming,\r\n        isSuccess,\r\n        error: writeError?.message || null,\r\n        reset: () => setIsSuccess(false),\r\n        hash\r\n    };\r\n};\r\n\r\nexport const useWithdraw = () => {\r\n    const { isConnected } = useAccount();\r\n    const contractAddress = useSmartContractAddress();\r\n    const { writeContract, data: hash, isPending: isWritePending, error: writeError } = useWriteContract();\r\n    const { isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForTransactionReceipt({ hash });\r\n\r\n    const [isSuccess, setIsSuccess] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (isConfirmed) {\r\n            setIsSuccess(true);\r\n            const historyItem = {\r\n                type: 'Withdraw',\r\n                hash: hash,\r\n                timestamp: Date.now(),\r\n                status: 'Success'\r\n            };\r\n            const existing = JSON.parse(localStorage.getItem('who-knows-history') || '[]');\r\n            localStorage.setItem('who-knows-history', JSON.stringify([historyItem, ...existing]));\r\n        }\r\n    }, [isConfirmed, hash]);\r\n\r\n    useEffect(() => {\r\n        if (writeError) {\r\n            setError(writeError.message);\r\n        }\r\n    }, [writeError]);\r\n\r\n    const withdraw = async (secret: string, recipient: string) => {\r\n        if (!isConnected) throw new Error('Wallet not connected');\r\n        setError(null);\r\n        setIsSuccess(false);\r\n\r\n        writeContract({\r\n            address: contractAddress,\r\n            abi: ABI,\r\n            functionName: 'withdraw',\r\n            args: [secret, recipient as `0x${string}`],\r\n        });\r\n    };\r\n\r\n    return {\r\n        withdraw,\r\n        isPending: isWritePending || isConfirming,\r\n        isSuccess,\r\n        error,\r\n        reset: () => { setIsSuccess(false); setError(null); },\r\n        hash\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\addresses.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\chains.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\config.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[619,622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[619,622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getDefaultConfig } from '@rainbow-me/rainbowkit';\r\nimport { chains } from './chains';\r\n\r\n// Use chains from shared library\r\nexport const megaethTestnet = chains.find(c => c.id === 6343)!;\r\n\r\nif (!process.env.NEXT_PUBLIC_MEGAETH_RPC_URL) {\r\n  // Silent fallback to avoid console noise\r\n}\r\n\r\n// Validate environment variables on load\r\nconst projectId = process.env.NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID || 'YOUR_PROJECT_ID';\r\n\r\nif (projectId === 'YOUR_PROJECT_ID') {\r\n  // Silent fallback for development\r\n}\r\n\r\nexport const config = getDefaultConfig({\r\n  appName: 'Who Knows?',\r\n  projectId,\r\n  chains: chains as any,\r\n  ssr: true,\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\crypto.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toHex' is defined but never used.","line":1,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"toHex"},"fix":{"range":[32,39],"text":""},"desc":"Remove unused variable \"toHex\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { keccak256, encodePacked, toHex } from 'viem';\r\n\r\n/**\r\n * Generate a cryptographically secure random secret note\r\n * Format: wk-<64 hex characters>\r\n */\r\nexport const generateSecret = (): string => {\r\n    const randomBytes = crypto.getRandomValues(new Uint8Array(32));\r\n    const hexString = Array.from(randomBytes)\r\n        .map(b => b.toString(16).padStart(2, '0'))\r\n        .join('');\r\n    return `wk-${hexString}`;\r\n};\r\n\r\n/**\r\n * Hash the secret to create commitment\r\n * Must match Solidity: keccak256(abi.encodePacked(secret))\r\n */\r\nexport const hashSecret = (secret: string): `0x${string}` => {\r\n    // encodePacked with 'string' type matches Solidity's abi.encodePacked(string)\r\n    return keccak256(encodePacked(['string'], [secret]));\r\n};\r\n\r\n/**\r\n * Validate secret format\r\n */\r\nexport const isValidSecret = (secret: string): boolean => {\r\n    return /^wk-[a-f0-9]{64}$/i.test(secret);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ipAddress' is defined but never used.","line":90,"column":85,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":94}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'db.json');\r\n\r\nexport type ReferralRecord = {\r\n    inviterAddress: string;\r\n    invitedAddress: string;\r\n    isValidated: boolean;\r\n    createdAt: number;\r\n    validatedAt: number | null;\r\n};\r\n\r\nexport type AntiSybilData = {\r\n    fingerprint: string | null;\r\n    ipAddress: string | null;\r\n    firstSeenAt: number;\r\n};\r\n\r\nexport type DBSchema = {\r\n    users: Record<string, UserData>;\r\n    referrals: Record<string, ReferralRecord>;\r\n    antiSybil: Record<string, AntiSybilData>;\r\n};\r\n\r\nexport function readDB(): DBSchema {\r\n    if (!fs.existsSync(DB_PATH)) {\r\n        return { users: {}, referrals: {}, antiSybil: {} };\r\n    }\r\n    const data = fs.readFileSync(DB_PATH, 'utf-8');\r\n    const parsed = JSON.parse(data);\r\n    // Ensure all tables exist\r\n    if (!parsed.referrals) parsed.referrals = {};\r\n    if (!parsed.antiSybil) parsed.antiSybil = {};\r\n    return parsed;\r\n}\r\n\r\nexport function writeDB(data: DBSchema) {\r\n    try {\r\n        fs.writeFileSync(DB_PATH, JSON.stringify(data, null, 2));\r\n    } catch (error) {\r\n        console.error(\"Failed to write to DB (likely read-only fs):\", error);\r\n    }\r\n}\r\n\r\nexport type QuestData = {\r\n    dailyTx: boolean;\r\n    dailyVol1: boolean;\r\n    dailyVol5: boolean;\r\n    dailyVol10: boolean;\r\n    dailyVol50: boolean;\r\n    dailyVol100: boolean;\r\n    weeklyVol1: boolean;\r\n};\r\n\r\nexport type UserData = {\r\n    address: string;\r\n    points: number;\r\n    referralPoints: number;\r\n    referralCode: string;\r\n    referredBy: string | null;\r\n    completedQuestsCount: number;\r\n    invites: string[];\r\n    transactions: number;\r\n    volume: number;\r\n    dailyVolume: number;\r\n    weeklyVolume: number;\r\n    lastTxTimestamp: number;\r\n    processedHashes: string[];\r\n    quests: QuestData;\r\n};\r\n\r\n// Helper: Create a referral record\r\nexport function createReferral(inviterAddress: string, invitedAddress: string): ReferralRecord {\r\n    return {\r\n        inviterAddress: inviterAddress.toLowerCase(),\r\n        invitedAddress: invitedAddress.toLowerCase(),\r\n        isValidated: false,\r\n        createdAt: Date.now(),\r\n        validatedAt: null,\r\n    };\r\n}\r\n\r\n// Helper: Get referral by invited address\r\nexport function getReferralByInvited(db: DBSchema, invitedAddress: string): ReferralRecord | null {\r\n    return db.referrals[invitedAddress.toLowerCase()] || null;\r\n}\r\n\r\n// Helper: Check for anti-Sybil violations\r\nexport function checkAntiSybil(db: DBSchema, address: string, fingerprint?: string, ipAddress?: string): { allowed: boolean; reason?: string } {\r\n    const normalizedAddress = address.toLowerCase();\r\n\r\n    // Check if fingerprint is already associated with another address\r\n    if (fingerprint) {\r\n        for (const [addr, data] of Object.entries(db.antiSybil)) {\r\n            if (addr !== normalizedAddress && data.fingerprint === fingerprint) {\r\n                return { allowed: false, reason: 'Device fingerprint already registered with another wallet' };\r\n            }\r\n        }\r\n    }\r\n\r\n    return { allowed: true };\r\n}\r\n\r\n// Helper: Record anti-Sybil data\r\nexport function recordAntiSybilData(db: DBSchema, address: string, fingerprint?: string, ipAddress?: string) {\r\n    const normalizedAddress = address.toLowerCase();\r\n    if (!db.antiSybil[normalizedAddress]) {\r\n        db.antiSybil[normalizedAddress] = {\r\n            fingerprint: fingerprint || null,\r\n            ipAddress: ipAddress || null,\r\n            firstSeenAt: Date.now(),\r\n        };\r\n    } else {\r\n        // Update if new data provided\r\n        if (fingerprint && !db.antiSybil[normalizedAddress].fingerprint) {\r\n            db.antiSybil[normalizedAddress].fingerprint = fingerprint;\r\n        }\r\n        if (ipAddress && !db.antiSybil[normalizedAddress].ipAddress) {\r\n            db.antiSybil[normalizedAddress].ipAddress = ipAddress;\r\n        }\r\n    }\r\n}\r\n\r\nexport function getOrCreateUser(address: string): UserData {\r\n    const db = readDB();\r\n    const normalizedAddress = address.toLowerCase();\r\n\r\n    if (!db.users[normalizedAddress]) {\r\n        db.users[normalizedAddress] = {\r\n            address: normalizedAddress,\r\n            points: 0,\r\n            referralPoints: 0,\r\n            referralCode: Math.random().toString(36).substring(2, 8).toUpperCase(),\r\n            referredBy: null,\r\n            completedQuestsCount: 0,\r\n            invites: [],\r\n            transactions: 0,\r\n            volume: 0,\r\n            dailyVolume: 0,\r\n            weeklyVolume: 0,\r\n            lastTxTimestamp: 0,\r\n            processedHashes: [],\r\n            quests: {\r\n                dailyTx: false,\r\n                dailyVol1: false,\r\n                dailyVol5: false,\r\n                dailyVol10: false,\r\n                dailyVol50: false,\r\n                dailyVol100: false,\r\n                weeklyVol1: false,\r\n            },\r\n        };\r\n        writeDB(db);\r\n    } else {\r\n        // Migration: Ensure new fields exist\r\n        const user = db.users[normalizedAddress];\r\n        if (user.referralPoints === undefined) user.referralPoints = 0;\r\n        if (user.referredBy === undefined) user.referredBy = null;\r\n        if (user.completedQuestsCount === undefined) {\r\n            // Recalculate quest count\r\n            user.completedQuestsCount = Object.values(user.quests).filter(Boolean).length;\r\n        }\r\n        if (user.processedHashes === undefined) user.processedHashes = [];\r\n        if (user.invites === undefined) user.invites = [];\r\n        // Fix: Ensure existing users have a referral code\r\n        if (!user.referralCode) {\r\n            user.referralCode = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n        }\r\n        db.users[normalizedAddress] = user;\r\n        writeDB(db);\r\n    }\r\n\r\n    return db.users[normalizedAddress];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\lib\\verifyTransaction.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":52,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createPublicClient, http, Hash } from 'viem';\r\nimport { sepolia, baseSepolia } from 'viem/chains';\r\nimport { megaethTestnet } from './chains';\r\n\r\n// Create clients for each supported chain\r\nconst clients = {\r\n    [sepolia.id]: createPublicClient({\r\n        chain: sepolia,\r\n        transport: http(process.env.SEPOLIA_RPC_URL)\r\n    }),\r\n    [baseSepolia.id]: createPublicClient({\r\n        chain: baseSepolia,\r\n        transport: http(process.env.BASE_SEPOLIA_RPC_URL)\r\n    }),\r\n    [megaethTestnet.id]: createPublicClient({\r\n        chain: megaethTestnet,\r\n        transport: http(process.env.NEXT_PUBLIC_MEGAETH_RPC_URL || 'https://carrot.megaeth.com/rpc')\r\n    })\r\n};\r\n\r\nexport async function verifyTransaction(hash: string, expectedAmount: string, expectedFrom: string) {\r\n    // Try to find the transaction on all chains\r\n    for (const client of Object.values(clients)) {\r\n        try {\r\n            const tx = await client.getTransaction({ hash: hash as Hash });\r\n\r\n            // Check if transaction exists and is successful\r\n            if (tx) {\r\n                const receipt = await client.getTransactionReceipt({ hash: hash as Hash });\r\n\r\n                if (receipt.status === 'success') {\r\n                    // Verify details\r\n                    // Note: In production code, you should also verify the 'to' address matches your contract\r\n                    // and the 'value' matches the deposit amount.\r\n                    // For now, we verify the sender matches the user claiming rewards.\r\n\r\n                    const isFromUser = tx.from.toLowerCase() === expectedFrom.toLowerCase();\r\n\r\n                    // Simple check: Allow if from user and confirmed\r\n                    // In a stricter version, we would check tx.value and tx.to against known contract addresses\r\n\r\n                    if (isFromUser) {\r\n                        return {\r\n                            verified: true,\r\n                            chainId: client.chain.id,\r\n                            blockNumber: receipt.blockNumber,\r\n                            value: tx.value\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            // Ignore errors (tx not found on this chain) and continue to next\r\n            continue;\r\n        }\r\n    }\r\n\r\n    return { verified: false };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\TAMA\\Downloads\\whoknowmixer\\who-knows-app\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]